\documentclass[../main/main.tex]{subfiles}

\begin{document}
	
	\section{Die Wassersteinmetrik}
	
	Wir orientieren uns an \cite{Villani.2009}.
	
	\begin{Definition}[Kopplung]
		Seien $X$, $Y$ topologische Räume und $A \subseteq \Probmeasures{X}$, $B \subseteq \Probmeasures{Y}$. Wir definieren dann
		\[ \Pi(A, B) \; \defby \; \setcomp{\pi \in \Probmeasures{X \times Y}}{\pi(\cdot \times Y) \in A \quad \text{und} \quad \pi(X \times \cdot) \in B} \text{.}\]
		Für $\mu \in \Probmeasures{X}$ und $\nu \in \Probmeasures{Y}$ definieren wir außerdem $\Pi(\mu, \nu) \; \defby \; \Pi(\set{\mu}, \set{\nu})$ und nennen die
		Elemente von $\Pi(\mu, \nu)$ \emph{Kopplungen} von $\mu$ und $\nu$ oder auch \emph{Transportpläne} zwischen $\mu$ und $\nu$.
	\end{Definition}

	\begin{Definition}[Kosten eines Transportplans]
		Seien $X$, $Y$ topologische Räume, $\mu \in \Probmeasures{X}$, $\nu \in \Probmeasures{Y}$ und $\fct{c}{X \times Y}{[0, \infty]}$ eine $\mathcal{B}(X \times Y)$-messbare Kostenfunktion.
		Die Kosten von $\pi \in \Pi(\mu, \nu)$ möchten wir dann mit
		\[ C(\pi) \; \defby \; \measureint{}{c}{\pi} \; = \; \measureintx{X \times Y}{c(x, y)}{\pi}{(x, y)} \in \; [0, \infty] \]
		bezeichnen.
	\end{Definition}

	\begin{Satz}[Existenz eines optimalen Transportplans]
		\label{thm:existenceoptimaltransportplan}
		Seien $X$, $Y$ polnische Räume, $\mu \in \Probmeasures{X}$, $\nu \in \Probmeasures{Y}$ und $\fct{c}{X \times Y}{[0, \infty]}$ eine $\mathcal{B}(X \times Y)$ eine stetige 
		Kostenfunktion. Dann existiert eine Kopplung $\hat{\pi}$ von $\mu$ und $\nu$, die 
		\[ C(\hat{\pi}) \; = \; \min_{\pi \in \Pi(\mu, \nu)} C(\pi) \]
		erfüllt. Wir nennen $\hat{\pi}$ eine \emph{optimale Kopplung} von $\mu$ und $\nu$ oder auch einen \emph{optimalen Transportplan} zwischen $\mu$ und $\nu$.
	\end{Satz}

	\begin{Hilfssatz}
		\label{lem:lsccost}
		In der Situation von Satz~\ref{thm:existenceoptimaltransportplan} gilt für jede schwach konvergente Folge $(\pi_k)_k \in \Probmeasures{X \times Y}^\N$ mit Grenzwert $\pi \in \Probmeasures{X \times Y}$ die Ungleichung
		\[ C(\pi) \; \leq \; \liminf_{k \to \infty} C(\pi_k) \text{.} \]
	\end{Hilfssatz}

	\begin{proof}
		Setzen wir $c_l \defby \min(c, l) \in \Bdcontfct{X}$ für alle $l \in \N$, so gilt $c_l \uparrow c$ punktweise. Sei nun $(\pi_k)_k \in \Probmeasures{X \times Y}^\N$ mit $\pi_k \xrightarrow{w} \pi \in \Probmeasures{X \times Y}$ eine schwach konvergente Folge. Dann gilt
		$\measureint{}{c_l}{\pi_k} \; \leq \; \measureint{}{c}{\pi_k}$ für alle $k, l \in \N$ und damit auch 
		\[ \measureint{}{c_l}{\pi} \; = \; \lim_{k \to \infty} \measureint{}{c_l}{\pi_k} \; \leq \; \liminf_{k \to \infty} \measureint{}{c}{\pi_k} \]
		für alle $l \in \N$. Der Satz von Beppo Levi liefert also
		\[ \measureint{}{c}{\pi} \; = \; \lim_{l \to \infty} \measureint{}{c_l}{\pi} \; \leq \; \liminf_{k \to \infty} \measureint{}{c}{\pi_k} \]
		und es folgt die Behauptung.
	\end{proof}

	\begin{Hilfssatz}
		\label{lem:couplingstight}
		Seien $X$, $Y$ polnische Räume und seien $A \subseteq \Probmeasures{X}$ sowie $B \subseteq \Probmeasures{Y}$ straffe Teilmengen. Dann ist $\Pi(A, B) \subseteq \Probmeasures{X \times Y}$ auch straff.
	\end{Hilfssatz}

	\begin{proof}
		Fixiere ein beliebiges $\varepsilon > 0 $ und wähle kompakte Teilmengen $K_{\varepsilon/2} \subseteq X$ sowie $L_{\varepsilon/2} \subseteq Y$ so, dass $\mu(K_{\varepsilon/2}) \geq 1 - \frac{\varepsilon}{2}$ 
		für alle $\mu \in A$ und $\nu(L_{\varepsilon/2}) \geq 1 - \frac{\varepsilon}{2}$ für alle $\nu \in B$ gilt. Dann ist $K_{\varepsilon/2} \times L_{\varepsilon/2} \subseteq \Probmeasures{X \times Y}$ auch kompakt und für jede Kopplung $\pi$ von $\mu$ und $\nu$ gilt
		\begin{align*}
			\pi(K_{\varepsilon/2} \times L_{\varepsilon/2}) \; &= \; 1 - \pi(K_{\varepsilon/2}^\mathsf{c} \times Y \cup X \times L_{\varepsilon/2}^\mathsf{c}) \\
			                                                   &\geq \; 1 - \mu(K_{\varepsilon/2}^\mathsf{c}) - \nu(L_{\varepsilon/2}^\mathsf{c}) \; \geq \; 1 - \varepsilon \text{,}
		\end{align*}
	also ist auch $\Pi(A, B) \subseteq \Probmeasures{X \times Y}$ straff.
	\end{proof}

	\begin{Hilfssatz}
		\label{lem:couplingsclosed}
		Seien $X$, $Y$ polnische Räume und $\mu \in \Probmeasures{X}$, $\nu \in \Probmeasures{Y}$. Dann ist $\Pi(\mu, \nu) \subseteq \Probmeasures{X \times Y}$ abgeschlossen.
	\end{Hilfssatz}

	\begin{proof}
		Weil $X \times Y$ auch polnisch ist und $\Probmeasures{X \times Y}$ damit nach Satz~\ref{thm:finitemeasurespolish} insbesondere metrisierbar ist, genügt es zu überprüfen, dass der Grenzwert $\pi$ einer jeden schwach konvergenten Folge $(\pi_k)_k \in \Pi(\mu, \nu)^\N$ wieder in $\Pi(\mu, \nu)$ liegt. Tatsächlich gilt für alle $f \in \Bdcontfct{X}$ und $k \in \N$
		\[ \measureintx{X \times Y}{f(x)}{\pi_k}{(x, y)} \; = \; \measureintx{X}{f(x)}{\mu}{x} \text{,} \]
		also auch 
		\[ \measureintx{X \times Y}{f(x)}{\pi}{(x, y)} \; = \; \lim_{k \to \infty} \measureintx{X \times Y}{f(x)}{\pi_k}{(x, y)} \; = \; \measureintx{X}{f(x)}{\mu}{x} \text{,} \]
		was nach Satz~\ref{thm:measureequality} $\pi(\cdot \times Y) = \mu$ impliziert. Analog sieht man auch $\pi(X \times \cdot) = \nu$ ein, sodass insgesamt $\pi \in \Pi(\mu, \nu)$ folgt.
	\end{proof}

	\begin{proof}[Beweis von Satz~\ref{thm:existenceoptimaltransportplan}]
		Zunächst sind $\mu \in \Probmeasures{X}$ und $\nu \in \Probmeasures{Y}$ nach Satz~\ref{thm:tightness} straff, also wegen Hilfssatz~\ref{lem:couplingstight} auch 
		$\Pi(\mu, \nu)$. Daraufhin liefert Hilfssatz~\ref{lem:couplingsclosed} gemeinsam mit dem Satz von Prokhorov (Satz~\ref{thm:prokhorov}) die Kompaktheit von $\Pi(\mu, \nu) \subseteq \Probmeasures{X \times Y}$.
		Sei nun $(\pi_k)_k \in \Pi(\mu, \nu)^\N$ mit
		\[ C(\pi_k) \; \to \inf_{\pi \in \Pi(\mu, \nu)} C(\pi) \text{,} \quad k \to \infty \text{.} \]
		Dann gibt es eine Teilfolge $(\pi_{k_l})_l$ und ein $\hat{\pi} \in \Pi(\mu, \nu)$ mit $\pi_{k_l} \xrightarrow{w} \hat{\pi}$. Nach Hilfssatz~\ref{lem:lsccost} gilt
		\[ C(\hat{\pi}) \; \leq \; \liminf_{k \to \infty} C(\pi_k) \; = \inf_{\pi \in \Pi(\mu, \nu)} C(\pi) \text{,} \]
		was bedeutet, dass $\hat{\pi}$ ein optimaler Transportplan zwischen $\mu$ und $\nu$ ist. 
	\end{proof}

	\begin{Definition}
		\label{def:wasserstein}
		Sei $(X, d)$ ein polnischer metrischer Raum, sei $p \in [1, \infty)$ und seien $\mu, \nu \in \Probmeasures{X}$. Dann nennen wir
		$$ W_p(\mu, \nu) \; \defby \; \left(\inf_{\pi \in \Pi(\mu, \nu)} \measureintx{X \times X}{d(x, y)^p}{\pi}{(x, y)}\right)^{\! 1/p} \; \in \; [0, \infty] $$
		die \emph{$p$-te Wassersteindistanz} zwischen $\mu$ und $\nu$.
	\end{Definition}

	\begin{Bemerkung}
		Offenbar ist $W_p(\delta_x, \delta_y) = d(x, y)$ für alle $x, y \in X$. 
	\end{Bemerkung}

	\begin{Satz}
		\label{thm:wassersteinismetric}
		In der Situation von Definition~\ref{def:wasserstein} erfüllt $W_p$ die Eigenschaften einer Metrik, abgesehen davon, dass $W_p(\mu, \nu) = \infty$ möglich ist.
	\end{Satz}

	\begin{proof}
		Offensichtlich ist $W_p$ symmetrisch.
		
		Für die positive Definitheit seien $\mu, \nu \in \Probmeasures{X}$ mit $W_p(\mu, \nu) = 0$. Dann ist
		\[ W_p(\mu, \nu)^p \; = \inf_{\pi \in \Pi(\mu, \nu)} \measureintx{X \times X}{d(x, y)^p}{\pi}{(x, y)} \; = \; 0 \]
		und da die Zuordnung $(x, y) \mapsto d(x, y)$ stetig ist, existiert nach Satz~\ref{thm:existenceoptimaltransportplan} eine Kopplung $\hat{\pi} \in \Pi(\mu, \nu)$ mit
		\[ \measureintx{X \times X}{d(x, y)^p}{\hat{\pi}}{(x, y)} \; = \; 0 \text{.} \]
		Damit folgt $\hat{\pi}(\setcomp{(x, x)}{x \in X}) = \hat{\pi}(\set{d(x, y)^p = 0}) = 1$ und für jedes $B \in \mathcal{B}(X)$ gilt
		$\mu(B) = \hat{\pi}(B \times X) = \hat{\pi}(X \times B) = \nu(B)$, also $\mu = \nu$.
		
		Es bleibt die Dreiecksungleichung zu zeigen. Seien dazu $\mu_1, \mu_2, \mu_3 \in \Probmeasures{X}$ und seien $\hat{\pi}_{1, 2}$ und $\hat{\pi}_{2, 3}$ optimale Kopplungen von
		$\mu_1$ und $\mu_2$ bzw. $\mu_2$ und $\mu_3$. Nach \cite[S. 23-24]{Villani.2009} gibt es nun ein Wahrscheinlichkeitsmaß $\pi \in \Probmeasures{X^3}$ mit 
		$\pi(\cdot \times X) = \hat{\pi}_{1, 2}$ und $\pi(X \times \cdot) = \hat{\pi}_{2, 3}$. Damit gilt
		\begin{align*}
			W_p(\mu_1, \mu_3) \; &\leq \; \left(\measureintx{X \times X}{d(x, z)^p}{\pi}{(x, y, z)}\right)^{\! 1/p} \\
			                     &\leq \; \left(\measureintx{X \times X}{d(x, y)^p}{\pi}{(x, y, z)}\right)^{\! 1/p} + \left(\measureintx{X \times X}{d(y, z)^p}{\pi}{(x, y, z)}\right)^{\! 1/p} \\
			                     &=    \; W_p(\mu_1, \mu_2) + W_p(\mu_2, \mu_3) \text{,}
		\end{align*}
		wobei wir bei der zweiten Abschätzung die Minkowski-Ungleichung anwenden.
	\end{proof}

	\begin{Definition}[Wassersteinraum]
		\label{def:wassersteinspace}
		Sei $(X, d)$ ein polnischer metrischer Raum, sei $p \in [1, \infty)$ und $x_0 \in X$. Dann nennen wir
		\[ \Wasprobmeasures{p}{X} \; \defby \; \setcomp{\mu \in \Probmeasures{X}}{W_p(\mu, \delta_{x_0}) < \infty} \]
		den $p$-ten Wassersteinraum von $(X, d)$.
	\end{Definition}

	\begin{Bemerkung}
		Die Dreiecksungleichung in Satz~\ref{thm:wassersteinismetric} impliziert unmittelbar, dass $\Wasprobmeasures{p}{X}$ nicht von der Wahl von $x_0 \in X$ abhängt 
		und dass $W_p$ auf $\Wasprobmeasures{p}{X}$ nur endliche Werte annimmt. $(\Wasprobmeasures{p}{X}, W_p)$ ist also ein metrischer Raum.
	\end{Bemerkung}

	\begin{Definition}[Schwache Konvergenz in $\mathcal{P}_p$]
		Hier steht was.
	\end{Definition}
	
\end{document}